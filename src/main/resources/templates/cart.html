<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>BookMarket Detail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
    <script src="/BookMarket/js/controllers.js">
        // integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        // crossorigin="anonymous"

    </script>

</head>
<body>

<main>
    <div class="container py-4">
        <th:block th:replace="~{/module/header}"></th:block>

        <div class="p-5 mb-4 bg-body-tertiary rounded-3">
            <div class="container-fluid py-5">
                <h1 class="display-5 fw-bold">장바구니</h1>
                <p class="col-md-8 fs-4">BookMarket</p>
            </div>
        </div>

        <div class="row align-items-md-stretch">


            <div class="col-md-12">
                <form name="deleteForm" method="post">
                    <input type = "hidden" name = "_method" value = "delete"/>
                    <div th:if="${cart != null and !cart.cartItems.isEmpty()}">
                        <a th:href="'javascript:deleteCart()'" class= "btn btn-danger" style="float:left">삭제하기</a>
                        <a th:href="'/BookMarket/order/'+${cartId}" class= "btn btn-success text-right" style="float:right">주문하기</a>
                    </div>
                    <div th:if="${cart == null or cart.cartItems.isEmpty()}">
                        <span class="text-muted" style="float:left">장바구니에 상품을 담아주세요.</span>
                    </div>
                </form>
            </div>
           <div style="padding-top: 50px">
               <table class="table table-hover">
                   <tr>
                       <th>도서</th>
                       <th>가격</th>
                       <th>수량</th>
                       <th>소계</th>
                       <th>비고</th>
                       <th></th>
                   </tr>
                   <form name="removeForm" method="post">
                       <input type = "hidden" name = "_method" value = "delete"/>
                   <div th:if = "${cart != null and !cart.cartItems.isEmpty()}">
                    <div th:each="cartItem : ${cart.cartItems}">
                       <tr>
                           <td th:text = "${cartItem.value.book.bookId} + ' - ' + ${cartItem.value.book.name}"></td>
                           <td th:text = "${cartItem.value.book.bookId} + ' - ' + ${cartItem.value.book.name}"></td>
                           <td th:text = "${cartItem.value.book.unitPrice}"></td>
                           <td th:text = "${cartItem.value.quantity}"></td>
                           <td th:text = "${cartItem.value.totalPrice}"></td>
                           <td><a th:href="'javascript:removeFromCart(\''+ ${cartItem.value.book.getBookId()} +'\', \''+ ${cartId} +'\')'"><span class = "badge text-bg-danger">삭제</span></sp></a></td>
                       </tr>
                    </div>
                   </div>
                   <div th:if = "${cart == null or cart.cartItems.isEmpty()}">
                       <tr>
                           <td colspan="6" class="text-center">장바구니가 비어 있습니다.</td>
                       </tr>
                   </div>
                   </form>
               </table>

               <div class = "text-end" style = "padding-right: 30px">
                    <b>총액</b>
                   <span th:if ="${cart != null}">
                       [[${cart.grandTotal}]]
                   </span>
               </div>
               <br>

            <p><a href = "/BookMarket/books" class = "btn btn-secondary" role = "button">&laquo;도서목록</a></p>
            </div>
        </div>
        <th:block th:replace="~{/module/footer}"></th:block>

    </div>
</main>
</body>
</html>